
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lillehammer Opening 2025</title>
    
    <!-- 1. Fix dla bibliotek oczekujących środowiska Node.js (naprawia błędy "process is not defined") -->
    <script>
        window.process = { env: { NODE_ENV: 'production' } };
    </script>

    <!-- 2. Pobieranie stylów Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- 3. Pobieranie React i ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- 4. Pobieranie Babel (tłumaczy kod Reacta w przeglądarce) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- 5. Pobieranie Ikon (Lucide React) - Zaktualizowana wersja -->
    <script src="https://unpkg.com/lucide-react@0.460.0/dist/umd/lucide-react.min.js"></script>

    <style>
        body { font-family: 'Inter', sans-serif; }
        /* Ukrywanie paska przewijania w niektórych elementach dla estetyki */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body class="bg-slate-50">
    <div id="root"></div>

    <!-- Główny skrypt aplikacji -->
    <script type="text/babel">
        // --- IMPORTY ZAMIENIONE NA ZMIENNE GLOBALNE ---
        const { useState, useMemo, useEffect } = React;
        
        // Pobieramy ikony z globalnego obiektu lucideReact
        // Upewniamy się, że obiekt istnieje, zanim spróbujemy go użyć
        const Icons = window.lucideReact || {};
        const { 
            Calendar, Filter, Search, ChevronDown, ChevronUp, Snowflake, Trophy, 
            Calculator, CheckSquare, Square, Star, Users, Globe, AlertCircle, 
            XCircle, Sun, Eye, EyeOff, Sliders 
        } = Icons;

        // --- DANE LILLEHAMMER (AKTYWNI W WEEKEND) ---
        const RAW_DATA = [
            { name: "Ryoyu Kobayashi", country: "JPN", isoCode: "jp", t1: 82.3, t2: 91.6, m1: 141.5, m2: 135.2, q1: 135.5, c1_1: 156.8, c1_2: 147.3, q2: 137.4, c2_1: 144.4, c2_2: 146.1 },
            { name: "Domen Prevc", country: "SLO", isoCode: "si", t1: 0, t2: 109.6, m1: 148.4, m2: 139.2, q1: 128.5, c1_1: 159.7, c1_2: 145.1, q2: 140.9, c2_1: 147.9, c2_2: 139.4 },
            { name: "Felix Hoffmann", country: "GER", isoCode: "de", t1: 95.8, t2: 106.6, m1: 143.1, m2: 144.9, q1: 146.1, c1_1: 158.9, c1_2: 134.7, q2: 130.8, c2_1: 143.8, c2_2: 142.4 },
            { name: "Philipp Raimund", country: "GER", isoCode: "de", t1: 80.1, t2: 87.1, m1: 133.7, m2: 131.2, q1: 137.5, c1_1: 154.9, c1_2: 148.5, q2: 132.8, c2_1: 144.1, c2_2: 141.3 },
            { name: "Stefan Kraft", country: "AUT", isoCode: "at", t1: 86.7, t2: 93.6, m1: 134.2, m2: 142.0, q1: 147.5, c1_1: 161.9, c1_2: 144.4, q2: 135.2, c2_1: 142.6, c2_2: 140.1 },
            { name: "Anze Lanisek", country: "SLO", isoCode: "si", t1: 83.9, t2: 96.7, m1: 0, m2: 0, q1: 133.1, c1_1: 156.8, c1_2: 140.2, q2: 130.1, c2_1: 143.5, c2_2: 136.7 },
            { name: "Daniel Tschofenig", country: "AUT", isoCode: "at", t1: 65.8, t2: 89.3, m1: 0, m2: 0, q1: 133.6, c1_1: 158.0, c1_2: 153.5, q2: 132.3, c2_1: 129.3, c2_2: 142.1 },
            { name: "Jan Hoerl", country: "AUT", isoCode: "at", t1: 87.8, t2: 109.4, m1: 148.5, m2: 145.6, q1: 139.0, c1_1: 156.8, c1_2: 150.4, q2: 144.7, c2_1: 142.2, c2_2: 125.8 },
            { name: "Stephan Embacher", country: "AUT", isoCode: "at", t1: 86.6, t2: 99.5, m1: 0, m2: 0, q1: 148.0, c1_1: 154.0, c1_2: 139.5, q2: 130.0, c2_1: 137.4, c2_2: 125.3 },
            { name: "Ren Nikaido", country: "JPN", isoCode: "jp", t1: 87.8, t2: 91.3, m1: 126.0, m2: 133.2, q1: 131.1, c1_1: 150.6, c1_2: 129.9, q2: 128.1, c2_1: 128.3, c2_2: 128.4 },
            { name: "Naoki Nakamura", country: "JPN", isoCode: "jp", t1: 85.9, t2: 91.5, m1: 0, m2: 0, q1: 112.6, c1_1: 139.1, c1_2: 129.6, q2: 120.3, c2_1: 129.5, c2_2: 126.6 },
            { name: "Kamil Stoch", country: "POL", isoCode: "pl", t1: 80.6, t2: 91.2, m1: 126.9, m2: 137.4, q1: 145.1, c1_1: 154.2, c1_2: 137.1, q2: 126.0, c2_1: 137.8, c2_2: 115.3 },
            { name: "Timi Zajc", country: "SLO", isoCode: "si", t1: 84.1, t2: 102.6, m1: 125.0, m2: 130.3, q1: 128.3, c1_1: 154.4, c1_2: 141.2, q2: 126.3, c2_1: 130.9, c2_2: 115.0 },
            { name: "Artti Aigro", country: "EST", isoCode: "ee", t1: 86.2, t2: 98.2, m1: 0, m2: 0, q1: 123.1, c1_1: 151.2, c1_2: 137.9, q2: 126.5, c2_1: 126.4, c2_2: 118.7 },
            { name: "Manuel Fettner", country: "AUT", isoCode: "at", t1: 81.6, t2: 97.2, m1: 0, m2: 0, q1: 118.6, c1_1: 149.1, c1_2: 144.7, q2: 124.5, c2_1: 124.2, c2_2: 119.8 },
            { name: "Valentin Foubert", country: "FRA", isoCode: "fr", t1: 69.7, t2: 84.1, m1: 120.8, m2: 0, q1: 122.5, c1_1: 143.2, c1_2: 129.4, q2: 120.1, c2_1: 125.8, c2_2: 117.3 },
            { name: "Marius Lindvik", country: "NOR", isoCode: "no", t1: 81.9, t2: 98.2, m1: 124.4, m2: 131.4, q1: 114.7, c1_1: 149.1, c1_2: 135.0, q2: 126.8, c2_1: 125.7, c2_2: 117.3 },
            { name: "Maximilian Ortner", country: "AUT", isoCode: "at", t1: 82.1, t2: 84.3, m1: 0, m2: 0, q1: 128.6, c1_1: 142.4, c1_2: 132.5, q2: 117.4, c2_1: 118.0, c2_2: 124.9 },
            { name: "Kristoffer E. Sundal", country: "NOR", isoCode: "no", t1: 96.7, t2: 104.7, m1: 117.4, m2: 121.4, q1: 123.7, c1_1: 129.8, c1_2: 0, q2: 119.2, c2_1: 121.0, c2_2: 120.4 },
            { name: "Dawid Kubacki", country: "POL", isoCode: "pl", t1: 64.9, t2: 77.7, m1: 0, m2: 0, q1: 114.9, c1_1: 135.1, c1_2: 142.0, q2: 107.8, c2_1: 117.9, c2_2: 120.9 },
            { name: "Antti Aalto", country: "FIN", isoCode: "fi", t1: 76.1, t2: 86.8, m1: 112.6, m2: 117.8, q1: 129.6, c1_1: 138.4, c1_2: 134.3, q2: 113.5, c2_1: 120.3, c2_2: 114.8 },
            { name: "Kacper Tomasiak", country: "POL", isoCode: "pl", t1: 73.6, t2: 90.6, m1: 126.7, m2: 120.6, q1: 129.9, c1_1: 144.4, c1_2: 138.8, q2: 118.2, c2_1: 123.2, c2_2: 111.6 },
            { name: "Karl Geiger", country: "GER", isoCode: "de", t1: 61.0, t2: 72.0, m1: 0, m2: 0, q1: 116.1, c1_1: 124.5, c1_2: 0, q2: 107.0, c2_1: 117.3, c2_2: 116.9 },
            { name: "Vladimir Zografski", country: "BUL", isoCode: "bg", t1: 86.3, t2: 94.0, m1: 0, m2: 0, q1: 134.4, c1_1: 144.5, c1_2: 147.6, q2: 120.7, c2_1: 119.7, c2_2: 114.0 },
            { name: "Gregor Deschwanden", country: "SUI", isoCode: "ch", t1: 77.4, t2: 88.8, m1: 0, m2: 0, q1: 132.9, c1_1: 146.1, c1_2: 138.8, q2: 122.7, c2_1: 113.7, c2_2: 119.9 },
            { name: "Jason Colby", country: "USA", isoCode: "us", t1: 74.4, t2: 83.3, m1: 0, m2: 0, q1: 133.6, c1_1: 139.2, c1_2: 141.0, q2: 106.9, c2_1: 124.4, c2_2: 108.0 },
            { name: "Pius Paschke", country: "GER", isoCode: "de", t1: 81.5, t2: 87.9, m1: 0, m2: 0, q1: 110.8, c1_1: 0, c1_2: 0, q2: 121.1, c2_1: 120.1, c2_2: 109.6 },
            { name: "Sakutaro Kobayashi", country: "JPN", isoCode: "jp", t1: 58.5, t2: 81.3, m1: 0, m2: 0, q1: 140.1, c1_1: 145.8, c1_2: 137.7, q2: 127.0, c2_1: 118.1, c2_2: 109.7 },
            { name: "Juri Kesseli", country: "SUI", isoCode: "ch", t1: 73.0, t2: 72.1, m1: 0, m2: 0, q1: 114.6, c1_1: 118.9, c1_2: 0, q2: 107.6, c2_1: 116.1, c2_2: 107.5 },
            { name: "Tomofumi Naito", country: "JPN", isoCode: "jp", t1: 73.0, t2: 78.9, m1: 0, m2: 0, q1: 124.9, c1_1: 134.3, c1_2: 0, q2: 109.2, c2_1: 114.1, c2_2: 109.1 },

            // --- ODPADLI W 1. SERII NIEDZIELI ---
            { name: "Kevin Bickner", country: "USA", isoCode: "us", t1: 79.6, t2: 91.1, m1: 114.6, m2: 0, q1: 114.4, c1_1: 130.7, c1_2: 0, q2: 111.7, c2_1: 113.6, c2_2: 0 },
            { name: "Sandro Hauswirth", country: "SUI", isoCode: "ch", t1: 58.3, t2: 63.7, m1: 110.4, m2: 0, q1: 125.0, c1_1: 132.3, c1_2: 0, q2: 110.8, c2_1: 111.9, c2_2: 0 },
            { name: "Mackenzie Boyd-Clowes", country: "CAN", isoCode: "ca", t1: 58.3, t2: 67.6, m1: 108.5, m2: 112.3, q1: 107.0, c1_1: 0, c1_2: 0, q2: 111.3, c2_1: 111.9, c2_2: 0 },
            { name: "Halvor Egner Granerud", country: "NOR", isoCode: "no", t1: 57.6, t2: 78.9, m1: 0, m2: 0, q1: 121.7, c1_1: 137.3, c1_2: 134.6, q2: 113.7, c2_1: 111.4, c2_2: 0 },
            { name: "Piotr Żyła", country: "POL", isoCode: "pl", t1: 63.7, t2: 74.5, m1: 0, m2: 0, q1: 120.3, c1_1: 139.0, c1_2: 144.0, q2: 112.7, c2_1: 111.2, c2_2: 0 },
            { name: "Paweł Wąsek", country: "POL", isoCode: "pl", t1: 53.5, t2: 81.4, m1: 0, m2: 0, q1: 121.4, c1_1: 135.0, c1_2: 133.7, q2: 116.2, c2_1: 111.1, c2_2: 0 },
            { name: "Tate Frantz", country: "USA", isoCode: "us", t1: 78.1, t2: 84.2, m1: 0, m2: 0, q1: 129.3, c1_1: 131.5, c1_2: 0, q2: 105.9, c2_1: 110.6, c2_2: 0 },
            { name: "Jules Chervet", country: "FRA", isoCode: "fr", t1: 62.6, t2: 71.7, m1: 84.5, m2: 0, q1: 94.5, c1_1: 0, c1_2: 0, q2: 102.4, c2_1: 109.8, c2_2: 0 },
            { name: "Simon Ammann", country: "SUI", isoCode: "ch", t1: 54.3, t2: 74.4, m1: 0, m2: 0, q1: 119.6, c1_1: 123.4, c1_2: 0, q2: 116.1, c2_1: 109.6, c2_2: 0 },
            { name: "Andreas Wellinger", country: "GER", isoCode: "de", t1: 35.0, t2: 47.8, m1: 0, m2: 0, q1: 104.9, c1_1: 0, c1_2: 0, q2: 105.4, c2_1: 109.5, c2_2: 0 },
            { name: "Yukiya Sato", country: "JPN", isoCode: "jp", t1: 50.0, t2: 72.5, m1: 0, m2: 0, q1: 129.0, c1_1: 133.0, c1_2: 0, q2: 104.3, c2_1: 106.9, c2_2: 0 },
            { name: "Alex Insam", country: "ITA", isoCode: "it", t1: 71.1, t2: 73.5, m1: 101.0, m2: 0, q1: 97.0, c1_1: 0, c1_2: 0, q2: 99.9, c2_1: 105.2, c2_2: 0 },
            { name: "Roman Koudelka", country: "CZE", isoCode: "cz", t1: 49.8, t2: 59.8, m1: 0, m2: 0, q1: 121.5, c1_1: 127.5, c1_2: 0, q2: 115.1, c2_1: 104.7, c2_2: 0 },
            { name: "Giovanni Bresadola", country: "ITA", isoCode: "it", t1: 72.4, t2: 69.3, m1: 0, m2: 0, q1: 128.7, c1_1: 113.3, c1_2: 0, q2: 108.8, c2_1: 103.1, c2_2: 0 },
            { name: "Rok Oblak", country: "SLO", isoCode: "si", t1: 67.5, t2: 73.8, m1: 0, m2: 0, q1: 118.2, c1_1: 126.8, c1_2: 0, q2: 107.4, c2_1: 100.0, c2_2: 0 },
            { name: "Ilja Miziernykh", country: "KAZ", isoCode: "kz", t1: 0, t2: 63.4, m1: 98.5, m2: 0, q1: 120.8, c1_1: 112.7, c1_2: 0, q2: 100.1, c2_1: 96.7, c2_2: 0 },
            { name: "Vilho Palosaari", country: "FIN", isoCode: "fi", t1: 67.5, t2: 71.2, m1: 112.8, m2: 111.9, q1: 108.9, c1_1: 0, c1_2: 0, q2: 102.0, c2_1: 96.6, c2_2: 0 },
            { name: "Andrew Urlaub", country: "USA", isoCode: "us", t1: 72.8, t2: 90.1, m1: 102.7, m2: 0, q1: 121.3, c1_1: 120.2, c1_2: 0, q2: 102.8, c2_1: 96.1, c2_2: 0 },
            { name: "Danil Vassilyev", country: "KAZ", isoCode: "kz", t1: 0, t2: 66.9, m1: 104.2, m2: 0, q1: 111.5, c1_1: 122.0, c1_2: 0, q2: 103.9, c2_1: 95.7, c2_2: 0 },
            { name: "Aleksander Zniszczoł", country: "POL", isoCode: "pl", t1: 77.3, t2: 74.0, m1: 0, m2: 0, q1: 96.4, c1_1: 0, c1_2: 0, q2: 109.4, c2_1: 91.8, c2_2: 0 },
            
            // --- INNI ---
            { name: "Benjamin Oestvold", country: "NOR", isoCode: "no", t1: 95.0, t2: 104.3, m1: 0, m2: 0, q1: 129.8, c1_1: 138.2, c1_2: 132.9, q2: 92.0, c2_1: 0, c2_2: 0 },
            { name: "Johann Andre Forfang", country: "NOR", isoCode: "no", t1: 86.2, t2: 95.5, m1: 0, m2: 0, q1: 114.4, c1_1: 140.5, c1_2: 126.4, q2: 97.8, c2_1: 0, c2_2: 0 },
            { name: "Lovro Kos", country: "SLO", isoCode: "si", t1: 69.1, t2: 71.1, m1: 0, m2: 0, q1: 120.7, c1_1: 124.6, c1_2: 0, q2: 98.8, c2_1: 0, c2_2: 0 },
            { name: "Fatih Arda Ipcioglu", country: "TUR", isoCode: "tr", t1: 42.4, t2: 45.7, m1: 0, m2: 0, q1: 111.4, c1_1: 116.6, c1_2: 0, q2: 0, c2_1: 0, c2_2: 0 },
            { name: "Erik Belshaw", country: "USA", isoCode: "us", t1: 64.1, t2: 77.1, m1: 0, m2: 0, q1: 120.8, c1_1: 121.1, c1_2: 0, q2: 99.8, c2_1: 0, c2_2: 0 },
            { name: "Vitaliy Kalinichenko", country: "UKR", isoCode: "ua", t1: 57.6, t2: 71.4, m1: 0, m2: 0, q1: 116.9, c1_1: 109.2, c1_2: 0, q2: 89.7, c2_1: 0, c2_2: 0 },
            { name: "Hektor Kapustik", country: "SVK", isoCode: "sk", t1: 53.0, t2: 45.7, m1: 0, m2: 0, q1: 113.2, c1_1: 96.9, c1_2: 0, q2: 0, c2_1: 0, c2_2: 0 },
            { name: "Louis Obersteiner", country: "AUT", isoCode: "at", t1: 53.3, t2: 64.7, m1: 0, m2: 0, q1: 95.6, c1_1: 0, c1_2: 0, q2: 92.0, c2_1: 0, c2_2: 0 },
            { name: "Tarik Vanwieren", country: "CAN", isoCode: "ca", t1: 0, t2: 0, m1: 73.2, m2: 67.6, q1: 87.1, c1_1: 0, c1_2: 0, q2: 74.2, c2_1: 0, c2_2: 0 },
            { name: "Felix Trunz", country: "SUI", isoCode: "ch", t1: 66.0, t2: 67.9, m1: 103.9, m2: 0, q1: 110.2, c1_1: 0, c1_2: 0, q2: 99.3, c2_1: 0, c2_2: 0 },
            { name: "Francesco Cecon", country: "ITA", isoCode: "it", t1: 67.7, t2: 76.2, m1: 102.8, m2: 0, q1: 92.2, c1_1: 0, c1_2: 0, q2: 88.4, c2_1: 0, c2_2: 0 },
            { name: "Yevhen Marusiak", country: "UKR", isoCode: "ua", t1: 0, t2: 51.2, m1: 0, m2: 0, q1: 110.6, c1_1: 0, c1_2: 0, q2: 62.0, c2_1: 0, c2_2: 0 },
            { name: "Muhammed Ali Bedir", country: "TUR", isoCode: "tr", t1: 34.9, t2: 51.8, m1: 0, m2: 0, q1: 82.3, c1_1: 0, c1_2: 0, q2: 66.9, c2_1: 0, c2_2: 0 },
            { name: "Daniel Andrei Cacina", country: "ROU", isoCode: "ro", t1: 39.9, t2: 40.7, m1: 66.4, m2: 0, q1: 80.7, c1_1: 0, c1_2: 0, q2: 67.2, c2_1: 0, c2_2: 0 },
            { name: "Mihnea Alexandru Spulber", country: "ROU", isoCode: "ro", t1: 0, t2: 33.5, m1: 60.6, m2: 0, q1: 66.1, c1_1: 0, c1_2: 0, q2: 59.5, c2_1: 0, c2_2: 0 },
            { name: "Yixin Lyu", country: "CHN", isoCode: "cn", t1: 0, t2: 0, m1: 69.6, m2: 0, q1: 80.3, c1_1: 0, c1_2: 0, q2: 63.5, c2_1: 0, c2_2: 0 },
            { name: "Weijie Zhen", country: "CHN", isoCode: "cn", t1: 0, t2: 0, m1: 50.6, m2: 0, q1: 55.9, c1_1: 0, c1_2: 0, q2: 46.1, c2_1: 0, c2_2: 0 },
            { name: "Svyatoslav Nazarenko", country: "KAZ", isoCode: "kz", t1: 0, t2: 37.3, m1: 0, m2: 0, q1: 79.7, c1_1: 0, c1_2: 0, q2: 45.4, c2_1: 0, c2_2: 0 },
            { name: "Kasperi Valto", country: "FIN", isoCode: "fi", t1: 59.4, t2: 60.5, m1: 0, m2: 0, q1: 0, c1_1: 0, c1_2: 0, q2: 76.6, c2_1: 0, c2_2: 0 },
        ];

        // --- DANE ZAWODNIKÓW PŚ 2024/25 (Ze zdjęcia) ---
        const WC_2025_DATA = [
            { rank: 1, name: "Daniel Tschofenig", country: "AUT", isoCode: "at", points: 1805 },
            { rank: 2, name: "Jan Hoerl", country: "AUT", isoCode: "at", points: 1652 },
            { rank: 3, name: "Stefan Kraft", country: "AUT", isoCode: "at", points: 1290 },
            { rank: 4, name: "Anze Lanisek", country: "SLO", isoCode: "si", points: 1056 },
            { rank: 5, name: "Pius Paschke", country: "GER", isoCode: "de", points: 1006 },
            { rank: 6, name: "Gregor Deschwanden", country: "SUI", isoCode: "ch", points: 996 },
            { rank: 7, name: "Andreas Wellinger", country: "GER", isoCode: "de", points: 989 },
            { rank: 8, name: "Johann Andre Forfang", country: "NOR", isoCode: "no", points: 955 },
            { rank: 9, name: "Ryoyu Kobayashi", country: "JPN", isoCode: "jp", points: 910 },
            { rank: 10, name: "Domen Prevc", country: "SLO", isoCode: "si", points: 776 },
            { rank: 11, name: "Maximilian Ortner", country: "AUT", isoCode: "at", points: 726 },
            { rank: 12, name: "Kristoffer E. Sundal", country: "NOR", isoCode: "no", points: 678 },
            { rank: 13, name: "Karl Geiger", country: "GER", isoCode: "de", points: 638 },
            { rank: 14, name: "Paweł Wąsek", country: "POL", isoCode: "pl", points: 612 },
            { rank: 15, name: "Michael Hayboeck", country: "AUT", isoCode: "at", points: 587 },
            { rank: 16, name: "Timi Zajc", country: "SLO", isoCode: "si", points: 572 },
            { rank: 17, name: "Marius Lindvik", country: "NOR", isoCode: "no", points: 474 },
            { rank: 18, name: "Manuel Fettner", country: "AUT", isoCode: "at", points: 458 },
            { rank: 19, name: "Ren Nikaido", country: "JPN", isoCode: "jp", points: 444 },
            { rank: 20, name: "Aleksander Zniszczoł", country: "POL", isoCode: "pl", points: 267 },
            { rank: 20, name: "Halvor Egner Granerud", country: "NOR", isoCode: "no", points: 267 },
            { rank: 22, name: "Tate Frantz", country: "USA", isoCode: "us", points: 266 },
            { rank: 23, name: "Artti Aigro", country: "EST", isoCode: "ee", points: 245 },
            { rank: 24, name: "Philipp Raimund", country: "GER", isoCode: "de", points: 242 },
            { rank: 25, name: "Naoki Nakamura", country: "JPN", isoCode: "jp", points: 212 },
            { rank: 26, name: "Benjamin Oestvold", country: "NOR", isoCode: "no", points: 211 },
            { rank: 27, name: "Valentin Foubert", country: "FRA", isoCode: "fr", points: 173 },
            { rank: 28, name: "Kevin Bickner", country: "USA", isoCode: "us", points: 171 },
            { rank: 29, name: "Vladimir Zografski", country: "BUL", isoCode: "bg", points: 165 },
            { rank: 30, name: "Lovro Kos", country: "SLO", isoCode: "si", points: 158 },
            { rank: 31, name: "Kamil Stoch", country: "POL", isoCode: "pl", points: 157 },
            { rank: 31, name: "Markus Mueller", country: "AUT", isoCode: "at", points: 157 },
            { rank: 33, name: "Killian Peier", country: "SUI", isoCode: "ch", points: 132 },
            { rank: 34, name: "Fredrik Villumstad", country: "NOR", isoCode: "no", points: 127 },
            { rank: 35, name: "Dawid Kubacki", country: "POL", isoCode: "pl", points: 122 },
            { rank: 36, name: "Antti Aalto", country: "FIN", isoCode: "fi", points: 116 },
            { rank: 37, name: "Jakub Wolny", country: "POL", isoCode: "pl", points: 111 },
            { rank: 38, name: "Markus Eisenbichler", country: "GER", isoCode: "de", points: 88 },
            { rank: 39, name: "Piotr Żyła", country: "POL", isoCode: "pl", points: 80 },
            { rank: 40, name: "Yevhen Marusiak", country: "UKR", isoCode: "ua", points: 76 },
            { rank: 40, name: "Sakutaro Kobayashi", country: "JPN", isoCode: "jp", points: 76 },
            { rank: 42, name: "Stephan Embacher", country: "AUT", isoCode: "at", points: 72 },
            { rank: 42, name: "Stephan Leyhe", country: "GER", isoCode: "de", points: 72 },
            { rank: 44, name: "Yukiya Sato", country: "JPN", isoCode: "jp", points: 69 },
            { rank: 45, name: "Zak Mogel", country: "SLO", isoCode: "si", points: 59 },
            { rank: 46, name: "Alex Insam", country: "ITA", isoCode: "it", points: 55 },
            { rank: 47, name: "Robin Pedersen", country: "NOR", isoCode: "no", points: 47 },
            { rank: 48, name: "Robert Johansson", country: "NOR", isoCode: "no", points: 32 },
            { rank: 49, name: "Niko Kytosaho", country: "FIN", isoCode: "fi", points: 28 },
            { rank: 50, name: "Felix Hoffmann", country: "GER", isoCode: "de", points: 27 }
        ];

        // --- DANE LGP 2025 (Ze zdjęcia) ---
        const LGP_2025_DATA = [
            { name: "Philipp Raimund", country: "GER", isoCode: "de", points: 490 },
            { name: "Sakutaro Kobayashi", country: "JPN", isoCode: "jp", points: 392 },
            { name: "Niklas Bachlinger", country: "AUT", isoCode: "at", points: 391 }, 
            { name: "Ryoyu Kobayashi", country: "JPN", isoCode: "jp", points: 356 },
            { name: "Kamil Stoch", country: "POL", isoCode: "pl", points: 319 },
            { name: "Naoki Nakamura", country: "JPN", isoCode: "jp", points: 315 },
            { name: "Dawid Kubacki", country: "POL", isoCode: "pl", points: 306 },
            { name: "Jan Hoerl", country: "AUT", isoCode: "at", points: 284 },
            { name: "Daniel Tschofenig", country: "AUT", isoCode: "at", points: 276 },
            { name: "Ren Nikaido", country: "JPN", isoCode: "jp", points: 230 },
            { name: "Maciej Kot", country: "POL", isoCode: "pl", points: 211 },
            { name: "Piotr Żyła", country: "POL", isoCode: "pl", points: 200 },
            { name: "Gregor Deschwanden", country: "SUI", isoCode: "ch", points: 187 },
            { name: "Lovro Kos", country: "SLO", isoCode: "si", points: 184 },
            { name: "Yukiya Sato", country: "JPN", isoCode: "jp", points: 156 },
            { name: "Ziga Jancar", country: "SLO", isoCode: "si", points: 156 },
            { name: "Stephan Embacher", country: "AUT", isoCode: "at", points: 154 },
            { name: "Marius Lindvik", country: "NOR", isoCode: "no", points: 150 },
            { name: "Danil Vassilyev", country: "KAZ", isoCode: "kz", points: 130 },
            { name: "Vladimir Zografski", country: "BUL", isoCode: "bg", points: 127 },
            { name: "Aleksander Zniszczoł", country: "POL", isoCode: "pl", points: 120 },
            { name: "Stefan Kraft", country: "AUT", isoCode: "at", points: 120 },
            { name: "Domen Prevc", country: "SLO", isoCode: "si", points: 118 },
            { name: "Juri Kesseli", country: "SUI", isoCode: "ch", points: 115 },
            { name: "Maximilian Ortner", country: "AUT", isoCode: "at", points: 112 },
            { name: "Luca Roth", country: "GER", isoCode: "de", points: 106 },
            { name: "Simon Ammann", country: "SUI", isoCode: "ch", points: 99 },
            { name: "Anze Lanisek", country: "SLO", isoCode: "si", points: 97 },
            { name: "Valentin Foubert", country: "FRA", isoCode: "fr", points: 96 },
            { name: "Felix Hoffmann", country: "GER", isoCode: "de", points: 81 },
            { name: "Manuel Fettner", country: "AUT", isoCode: "at", points: 80 },
            { name: "Clemens Leitner", country: "AUT", isoCode: "at", points: 72 },
            { name: "Pius Paschke", country: "GER", isoCode: "de", points: 70 },
            { name: "Johann Andre Forfang", country: "NOR", isoCode: "no", points: 65 },
            { name: "Hektor Kapustik", country: "SVK", isoCode: "sk", points: 61 },
            { name: "Jason Colby", country: "USA", isoCode: "us", points: 61 },
            { name: "Timi Zajc", country: "SLO", isoCode: "si", points: 61 },
            { name: "Giovanni Bresadola", country: "ITA", isoCode: "it", points: 60 },
            { name: "Jonas Schuster", country: "AUT", isoCode: "at", points: 59 },
            { name: "Andreas Wellinger", country: "GER", isoCode: "de", points: 58 },
            { name: "Felix Trunz", country: "SUI", isoCode: "ch", points: 58 },
            { name: "Roman Koudelka", country: "CZE", isoCode: "cz", points: 54 },
            { name: "Artti Aigro", country: "EST", isoCode: "ee", points: 47 },
            { name: "Halvor Egner Granerud", country: "NOR", isoCode: "no", points: 45 },
            { name: "Julian Smid", country: "AUT", isoCode: "at", points: 44 },
            { name: "Clemens Aigner", country: "AUT", isoCode: "at", points: 42 },
            { name: "Vilho Palosaari", country: "FIN", isoCode: "fi", points: 41 },
            { name: "Yanick Wasser", country: "SUI", isoCode: "ch", points: 40 },
            { name: "Zak Mogel", country: "SLO", isoCode: "si", points: 40 },
            { name: "Killian Peier", country: "SUI", isoCode: "ch", points: 40 },
            { name: "Enej Faletic", country: "SLO", isoCode: "si", points: 40 },
            { name: "Tate Frantz", country: "USA", isoCode: "us", points: 38 },
            { name: "Andrew Urlaub", country: "USA", isoCode: "us", points: 36 },
            { name: "Kristoffer E. Sundal", country: "NOR", isoCode: "no", points: 34 },
            { name: "Ziga Jelar", country: "SLO", isoCode: "si", points: 33 },
            { name: "Mackenzie Boyd-Clowes", country: "CAN", isoCode: "ca", points: 33 },
            { name: "Kacper Tomasiak", country: "POL", isoCode: "pl", points: 32 },
            { name: "Paweł Wąsek", country: "POL", isoCode: "pl", points: 30 },
            { name: "Antti Aalto", country: "FIN", isoCode: "fi", points: 30 },
            { name: "Sandro Hauswirth", country: "SUI", isoCode: "ch", points: 30 },
            { name: "Karl Geiger", country: "GER", isoCode: "de", points: 29 },
            { name: "Kacper Juroszek", country: "POL", isoCode: "pl", points: 18 },
            { name: "Jakub Wolny", country: "POL", isoCode: "pl", points: 15 },
        ];

        const EVENTS = {
            t1: { id: 't1', label: "T1 (Pt)", full: "1. Trening", color: "text-slate-500", group: "training" },
            t2: { id: 't2', label: "T2 (Pt)", full: "2. Trening", color: "text-slate-500", group: "training" },
            m1: { id: 'm1', label: "M1 (Mix)", full: "Mikst (1. Seria)", color: "text-purple-600", group: "mix" },
            m2: { id: 'm2', label: "M2 (Mix)", full: "Mikst (Finał)", color: "text-purple-600", group: "mix" },
            q1: { id: 'q1', label: "Q (Sob)", full: "Kwalifikacje Sobota", color: "text-blue-600", group: "quali" },
            c1_1: { id: 'c1_1', label: "C1-1 (Sob)", full: "Konkurs Sobota (1. Seria)", color: "text-blue-700 font-bold", group: "comp" },
            c1_2: { id: 'c1_2', label: "C1-2 (Sob)", full: "Konkurs Sobota (Finał)", color: "text-blue-700 font-bold", group: "comp" },
            q2: { id: 'q2', label: "Q (Ndz)", full: "Kwalifikacje Niedziela", color: "text-blue-600", group: "quali" },
            c2_1: { id: 'c2_1', label: "C2-1 (Ndz)", full: "Konkurs Niedziela (1. Seria)", color: "text-blue-700 font-bold", group: "comp" },
            c2_2: { id: 'c2_2', label: "C2-2 (Ndz)", full: "Konkurs Niedziela (Finał)", color: "text-blue-700 font-bold", group: "comp" },
        };

        // Lista zawodników wybranych w Fantasy Draft
        const DRAFT_PLAYERS = [
            "Stefan Kraft", "Philipp Raimund", "Felix Hoffmann", "Sakutaro Kobayashi", "Antti Aalto", "Artti Aigro",
            "Manuel Fettner", "Pius Paschke", "Anze Lanisek", "Kamil Stoch", "Ryoyu Kobayashi",
            "Jan Hoerl", "Timi Zajc", "Marius Lindvik", "Dawid Kubacki", "Ren Nikaido",
            "Daniel Tschofenig", "Stephan Embacher", "Andreas Wellinger", "Domen Prevc", "Gregor Deschwanden", "Kacper Tomasiak",
            "Johann Andre Forfang", "Naoki Nakamura"
        ];

        const ALL_EVENT_KEYS = Object.keys(EVENTS);
        const DEFAULT_COLUMNS = ['c1_1', 'c1_2', 'c2_1', 'c2_2'];

        const calculateDraftPointsFromMap = (skierMap, sortKey) => {
            const sorted = Object.values(skierMap)
                .filter(s => s[sortKey] > 0)
                .sort((a, b) => b[sortKey] - a[sortKey]);

            let currentRank = 1;
            let rankCounter = 1;
            let lastVal = null;

            const ranked = sorted.map((item) => {
                let val = item[sortKey];
                if (lastVal !== null && val !== lastVal) {
                    currentRank = rankCounter;
                }
                lastVal = val;
                rankCounter++;
                return { ...item, computedRank: currentRank };
            });

            const draftPointsMap = {};
            ranked.forEach(item => {
                const points = item.computedRank <= 30 ? (31 - item.computedRank) : 0;
                draftPointsMap[item.name] = points;
            });
            
            return draftPointsMap;
        };

        function SkiJumpingApp() {
            const [activeTab, setActiveTab] = useState('lillehammer'); 
            const [minJumps, setMinJumps] = useState(0);
            const [searchTerm, setSearchTerm] = useState("");
            const [sortBy, setSortBy] = useState('customSum'); // Domyślne sortowanie: Wybór Σ
            const [sortDirection, setSortDirection] = useState('desc');
            const [showDraftHighlight, setShowDraftHighlight] = useState(true);
            const [onlyDraft, setOnlyDraft] = useState(false);
            const [draftMode, setDraftMode] = useState('sunday'); 
            const [showDraftColumn, setShowDraftColumn] = useState(false);
            const [showBestNColumn, setShowBestNColumn] = useState(false);
            
            const [selectedColumns, setSelectedColumns] = useState(DEFAULT_COLUMNS);
            const [bestN, setBestN] = useState(10);

            const activePlayersSet = useMemo(() => {
                const set = new Set(RAW_DATA.map(p => p.name));
                set.add("Wasiljew Danił");
                set.add("Danil Vassilyev");
                return set;
            }, []);

            const isPlayerActive = (name) => {
                if (activePlayersSet.has(name)) return true;
                if (name === "Danil Vassilyev" && activePlayersSet.has("Wasiljew Danił")) return true;
                if (name === "Wasiljew Danił" && activePlayersSet.has("Danil Vassilyev")) return true;
                return false;
            };

            // Reset sort when changing tabs
            useEffect(() => {
                if (activeTab === 'lillehammer') {
                    setSortBy('customSum'); 
                } else {
                    setSortBy('points'); 
                }
                setSortDirection('desc');
            }, [activeTab]);

            const toggleColumn = (key) => {
                if (selectedColumns.includes(key)) {
                    setSelectedColumns(prev => prev.filter(k => k !== key));
                } else {
                    setSelectedColumns(prev => [...prev, key]);
                }
            };

            const selectGroup = (groupName) => {
                if (groupName === 'all') {
                    setSelectedColumns(ALL_EVENT_KEYS);
                } else if (groupName === 'none') {
                    setSelectedColumns([]);
                } else {
                    const groupKeys = Object.values(EVENTS).filter(e => e.group === groupName).map(e => e.id);
                    const allSelected = groupKeys.every(k => selectedColumns.includes(k));
                    if (allSelected) {
                        setSelectedColumns(prev => prev.filter(k => !groupKeys.includes(k)));
                    } else {
                        const newSet = new Set([...selectedColumns, ...groupKeys]);
                        setSelectedColumns(Array.from(newSet));
                    }
                }
            };

            // --- KOLEJNOŚĆ EFEKTÓW ---
            
            // 1. Efekt od bestN
            useEffect(() => {
                if (activeTab === 'lillehammer') {
                    setSortBy('bestNSum');
                    setSortDirection('desc');
                }
            }, [bestN, activeTab]);

            // 2. Efekt od selectedColumns (uruchomi się jako drugi przy starcie i ustawi 'customSum')
            useEffect(() => {
                if (activeTab === 'lillehammer') {
                    setSortBy('customSum');
                    setSortDirection('desc');
                }
            }, [selectedColumns, activeTab]);

            // -------------------------

            const processedData = useMemo(() => {
                const skiersMap = {};
                RAW_DATA.forEach(skier => {
                    const satTotal = (skier.c1_1 || 0) + (skier.c1_2 || 0);
                    const sunTotal = (skier.c2_1 || 0) + (skier.c2_2 || 0);
                    skiersMap[skier.name] = { ...skier, satTotal, sunTotal };
                });

                const satDraftPoints = calculateDraftPointsFromMap(skiersMap, 'satTotal');
                const sunDraftPoints = calculateDraftPointsFromMap(skiersMap, 'sunTotal');

                return Object.values(skiersMap).map(skier => {
                    let totalPoints = 0;
                    let seriesCount = 0;
                    let scores = [];
                    let customSum = 0;

                    const isDraft = DRAFT_PLAYERS.includes(skier.name);

                    ALL_EVENT_KEYS.forEach(key => {
                        const points = skier[key] || 0;
                        if (points > 0) {
                            totalPoints += points;
                            seriesCount += 1;
                            scores.push({ key, points });
                        }
                    });

                    selectedColumns.forEach(key => {
                        customSum += (skier[key] || 0);
                    });

                    const sortedScores = [...scores].sort((a, b) => b.points - a.points);
                    const bestNSum = sortedScores.slice(0, bestN).reduce((sum, item) => sum + item.points, 0);
                    const avgPoints = seriesCount > 0 ? (totalPoints / seriesCount).toFixed(1) : 0;

                    const draftPtsSat = satDraftPoints[skier.name] || 0;
                    const draftPtsSun = sunDraftPoints[skier.name] || 0;
                    const draftTotal = draftMode === 'weekend' ? (draftPtsSat + draftPtsSun) : draftPtsSun;

                    return {
                        ...skier,
                        totalPoints: parseFloat(totalPoints.toFixed(1)),
                        seriesCount,
                        avgPoints: parseFloat(avgPoints),
                        customSum: parseFloat(customSum.toFixed(1)),
                        bestNSum: parseFloat(bestNSum.toFixed(1)),
                        isDraft,
                        draftTotal,
                        draftPtsSat,
                        draftPtsSun
                    };
                });
            }, [selectedColumns, bestN, draftMode]);

            const processExternalData = (data) => {
                return data.map(skier => {
                    const isDraft = DRAFT_PLAYERS.includes(skier.name);
                    const isActive = isPlayerActive(skier.name);
                    return { ...skier, isDraft, isActive };
                });
            };

            const processedWCData = useMemo(() => processExternalData(WC_2025_DATA), [activePlayersSet]);
            const processedLGPData = useMemo(() => processExternalData(LGP_2025_DATA), [activePlayersSet]);

            const getFilteredData = (data, isExternal = false) => {
                let filtered = data.filter(skier => {
                    const matchesSearch = skier.name.toLowerCase().includes(searchTerm.toLowerCase()) || 
                                          skier.country.toLowerCase().includes(searchTerm.toLowerCase());
                    const matchesDraft = onlyDraft ? skier.isDraft : true;
                    if (isExternal) return matchesSearch && matchesDraft;
                    return matchesSearch && matchesDraft && skier.seriesCount >= minJumps;
                });

                filtered.sort((a, b) => {
                    let valA = a[sortBy] ?? 0;
                    let valB = b[sortBy] ?? 0;
                    if (sortDirection === 'asc') return valA - valB;
                    return valB - valA;
                });

                let currentRank = 1;
                let rankCounter = 1;
                let lastVal = null;

                return filtered.map((item) => {
                    let val = item[sortBy];
                    if (lastVal !== null && val !== lastVal) {
                        currentRank = rankCounter;
                    }
                    lastVal = val;
                    rankCounter++;
                    return { ...item, displayRank: currentRank };
                });
            };

            let displayData = [];
            if (activeTab === 'lillehammer') displayData = getFilteredData(processedData);
            else if (activeTab === 'wc2425') displayData = getFilteredData(processedWCData, true);
            else if (activeTab === 'lgp2025') displayData = getFilteredData(processedLGPData, true);

            const handleSort = (key) => {
                if (sortBy === key) {
                    setSortDirection(prev => prev === 'desc' ? 'asc' : 'desc');
                } else {
                    setSortBy(key);
                    setSortDirection('desc');
                }
            };

            const getRowStyle = (skier) => {
                if (activeTab !== 'lillehammer' && !skier.isActive) {
                    return "bg-red-100 border-red-300 text-red-900 hover:bg-red-200 transition-colors font-medium";
                }
                if (showDraftHighlight && skier.isDraft) {
                    return "bg-indigo-100 border-indigo-300 hover:bg-indigo-200 transition-colors shadow-sm relative z-10";
                }
                return "hover:bg-slate-50 transition-colors bg-white";
            };

            const getRankBadgeStyle = (rank) => {
                if (sortBy === 'seriesCount' || sortBy === 'name') return "bg-white border-slate-200 text-slate-600";
                if (rank === 1) return "bg-yellow-100 border-yellow-400 text-yellow-800";
                if (rank === 2) return "bg-slate-100 border-slate-300 text-slate-700";
                if (rank === 3) return "bg-orange-100 border-orange-300 text-orange-800";
                return "bg-white border-slate-200 text-slate-600";
            };

            return (
                <div className="min-h-screen bg-slate-50 p-2 md:p-4 font-sans text-slate-900">
                    <header className="max-w-[1600px] mx-auto mb-4 md:mb-6 bg-white rounded-2xl shadow-sm border border-slate-200 p-4 md:p-6 relative overflow-hidden">
                        <div className="absolute top-0 right-0 p-4 opacity-10">
                            <Snowflake size={80} className="md:w-[120px] md:h-[120px]" />
                        </div>
                        <div className="relative z-10 flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                            <div>
                                <div className="flex items-center gap-2 md:gap-3 mb-2">
                                    <span className="px-2 py-0.5 md:px-3 md:py-1 bg-blue-600 text-white text-[10px] md:text-xs font-bold rounded-full tracking-wider uppercase">Sezon 2025/26</span>
                                    <span className="text-slate-500 text-xs md:text-sm font-medium flex items-center gap-1">
                                        <Calendar size={14} /> 21-23 Listopada 2025
                                    </span>
                                </div>
                                <h1 className="text-2xl md:text-3xl font-extrabold text-slate-900 mb-1 leading-tight">
                                    Lillehammer Opening
                                </h1>
                                <p className="text-slate-500 text-xs md:text-sm max-w-xl">
                                    Pełne zestawienie wyników z wyróżnieniem Fantasy Draft.
                                </p>
                            </div>
                        </div>

                        <div className="flex gap-2 mt-6 border-b border-slate-100 pb-1 overflow-x-auto no-scrollbar">
                            <button 
                                onClick={() => setActiveTab('lillehammer')}
                                className={`px-4 py-2 text-sm font-bold rounded-t-lg transition-all flex items-center gap-2 whitespace-nowrap ${activeTab === 'lillehammer' ? 'bg-slate-100 text-blue-600 border-b-2 border-blue-600' : 'text-slate-400 hover:text-slate-600'}`}
                            >
                                <Snowflake size={16}/> Wyniki Lillehammer
                            </button>
                            <button 
                                onClick={() => setActiveTab('wc2425')}
                                className={`px-4 py-2 text-sm font-bold rounded-t-lg transition-all flex items-center gap-2 whitespace-nowrap ${activeTab === 'wc2425' ? 'bg-slate-100 text-blue-600 border-b-2 border-blue-600' : 'text-slate-400 hover:text-slate-600'}`}
                            >
                                <Globe size={16}/> Puchar Świata 24/25
                            </button>
                            <button 
                                onClick={() => setActiveTab('lgp2025')}
                                className={`px-4 py-2 text-sm font-bold rounded-t-lg transition-all flex items-center gap-2 whitespace-nowrap ${activeTab === 'lgp2025' ? 'bg-slate-100 text-orange-600 border-b-2 border-orange-600' : 'text-slate-400 hover:text-slate-600'}`}
                            >
                                <Sun size={16}/> Letnie GP 2025
                            </button>
                        </div>
                    </header>

                    <div className="max-w-[1600px] mx-auto mb-4 grid grid-cols-1 lg:grid-cols-12 gap-4">
                        <div className="lg:col-span-3 space-y-3">
                           <div className="bg-gradient-to-br from-indigo-50 to-blue-50 p-3 rounded-xl border border-indigo-200 shadow-sm">
                                <div className="flex items-center gap-2 mb-3 text-indigo-800 text-xs font-bold uppercase">
                                    <Star size={14} fill="currentColor" /> Fantasy Draft
                                </div>
                                <div className="space-y-2">
                                    <label className="flex items-center gap-2 cursor-pointer p-2 bg-white/60 rounded-lg hover:bg-white transition-colors">
                                        <div className={`w-4 h-4 border rounded flex items-center justify-center ${showDraftHighlight ? 'bg-indigo-600 border-indigo-700' : 'border-slate-300 bg-white'}`}>
                                            {showDraftHighlight && <CheckSquare size={12} className="text-white" />}
                                        </div>
                                        <input type="checkbox" className="hidden" checked={showDraftHighlight} onChange={() => setShowDraftHighlight(!showDraftHighlight)} />
                                        <span className="text-sm font-medium text-slate-700">Wyróżnij graczy (Niebieski)</span>
                                    </label>

                                    <button 
                                        onClick={() => setOnlyDraft(!onlyDraft)}
                                        className={`w-full text-left flex items-center gap-2 cursor-pointer p-2 rounded-lg transition-all ${onlyDraft ? 'bg-indigo-600 text-white shadow-sm' : 'bg-white/60 text-slate-700 hover:bg-white'}`}
                                    >
                                        <Users size={14} />
                                        <span className="text-sm font-bold">{onlyDraft ? 'Pokazujesz tylko Draft' : 'Pokaż tylko Draft'}</span>
                                    </button>

                                    {activeTab === 'lillehammer' && (
                                        <>
                                            <div className="pt-2 border-t border-indigo-100 mt-2">
                                                <div className="text-[10px] text-indigo-400 font-bold uppercase mb-1">Widoczność:</div>
                                                <label className="flex items-center gap-2 cursor-pointer p-2 bg-white/60 rounded-lg hover:bg-white transition-colors">
                                                    <div className={`w-4 h-4 border rounded flex items-center justify-center ${showDraftColumn ? 'bg-indigo-600 border-indigo-700' : 'border-slate-300 bg-white'}`}>
                                                        {showDraftColumn && <CheckSquare size={12} className="text-white" />}
                                                    </div>
                                                    <input type="checkbox" className="hidden" checked={showDraftColumn} onChange={() => setShowDraftColumn(!showDraftColumn)} />
                                                    <span className="text-sm font-medium text-slate-700 flex items-center gap-1">
                                                       {showDraftColumn ? <Eye size={14}/> : <EyeOff size={14}/>} Pokaż kolumnę Pkt Draft
                                                    </span>
                                                </label>
                                            </div>
                                            <div className="pt-2 border-t border-indigo-100 mt-2">
                                                <div className="text-[10px] text-indigo-400 font-bold uppercase mb-1">Tryb obliczeń Draftu:</div>
                                                <div className="flex bg-white rounded-lg p-1 border border-indigo-100">
                                                    <button onClick={() => setDraftMode('sunday')} className={`flex-1 py-1 text-[10px] font-bold rounded transition-all ${draftMode === 'sunday' ? 'bg-indigo-100 text-indigo-700' : 'text-slate-400'}`}>Niedziela</button>
                                                    <button onClick={() => setDraftMode('weekend')} className={`flex-1 py-1 text-[10px] font-bold rounded transition-all ${draftMode === 'weekend' ? 'bg-indigo-100 text-indigo-700' : 'text-slate-400'}`}>Sob + Ndz</button>
                                                </div>
                                            </div>
                                        </>
                                    )}
                                </div>
                           </div>

                           <div className="bg-white p-3 rounded-xl border border-slate-200 shadow-sm">
                                <div className="flex items-center gap-2 mb-2 text-slate-400 text-xs font-bold uppercase">
                                    <Search size={14}/> Szukaj
                                </div>
                                <input 
                                    type="text" 
                                    placeholder="Nazwisko lub kraj (np. POL)..." 
                                    className="w-full bg-slate-50 border border-slate-200 rounded-lg p-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"
                                    value={searchTerm}
                                    onChange={(e) => setSearchTerm(e.target.value)}
                                />
                           </div>

                           {activeTab === 'lillehammer' && (
                             <div className="bg-white p-3 rounded-xl border border-slate-200 shadow-sm">
                                    <div className="flex items-center gap-2 mb-2 text-slate-400 text-xs font-bold uppercase">
                                        <Filter size={14}/> Min. zaliczonych serii
                                    </div>
                                    <div className="flex flex-wrap gap-1">
                                       {[0, 5, 6, 7, 8, 9, 10].map(num => (
                                            <button 
                                                key={num}
                                                onClick={() => setMinJumps(num)}
                                                className={`flex-1 px-2 py-1.5 rounded-md text-xs font-bold transition-all ${minJumps === num ? 'bg-blue-600 text-white' : 'bg-slate-100 text-slate-500 hover:bg-slate-200'}`}
                                            >
                                                {num === 0 ? 'Wszyscy' : num}
                                            </button>
                                       ))}
                                    </div>
                             </div>
                           )}
                        </div>

                        <div className="lg:col-span-9">
                            {activeTab === 'lillehammer' ? (
                                <div className="bg-white rounded-xl border border-blue-200 shadow-sm p-4 relative overflow-hidden h-full">
                                   <div className="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-blue-400 to-purple-500"></div>
                                   <div className="flex items-center gap-2 mb-4">
                                        <Calculator className="text-blue-600" size={20} />
                                        <h2 className="font-bold text-slate-800">Kreator Rankingu</h2>
                                   </div>

                                   <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                        <div>
                                             <div className="text-xs font-bold text-slate-500 uppercase mb-2 flex justify-between items-center">
                                                    <span>Wybierz serie do sumowania:</span>
                                                    <div className="flex gap-2 scale-90 origin-right">
                                                         <button onClick={() => selectGroup('all')} className="text-blue-600 hover:underline font-bold">Wszystkie</button>
                                                         <button onClick={() => selectGroup('comp')} className="text-blue-600 hover:underline font-bold">Tylko Konkursy</button>
                                                         <button onClick={() => selectGroup('none')} className="text-slate-400 hover:underline">Żadne</button>
                                                    </div>
                                             </div>
                                             <div className="flex flex-wrap gap-1.5">
                                                    {ALL_EVENT_KEYS.map(key => {
                                                         const evt = EVENTS[key];
                                                         const isSelected = selectedColumns.includes(key);
                                                         return (
                                                                <button
                                                                    key={key}
                                                                    onClick={() => toggleColumn(key)}
                                                                    className={`px-2 py-1 rounded text-[10px] font-bold border transition-all flex items-center gap-1 ${isSelected ? 'bg-blue-50 border-blue-300 text-blue-700' : 'bg-white border-slate-200 text-slate-400'}`}
                                                                    title={evt.full}
                                                                >
                                                                     {isSelected ? <CheckSquare size={10}/> : <Square size={10}/>}
                                                                     {evt.label}
                                                                </button>
                                                         )
                                                    })}
                                             </div>
                                             <div className="mt-2 text-xs text-slate-400">
                                                    Aktualnie sumujesz: <span className="font-bold text-blue-600">{selectedColumns.length}</span> serii. 
                                                    Wynik w kolumnie <span className="bg-blue-100 text-blue-800 px-1 rounded font-mono">Wybór Σ</span>.
                                             </div>
                                        </div>

                                        <div className="border-t md:border-t-0 md:border-l border-slate-100 pt-4 md:pt-0 pl-0 md:pl-6">
                                             <div className="text-xs font-bold text-slate-500 uppercase mb-2">
                                                    Ranking "The Best Of":
                                             </div>
                                             <div className="flex items-center gap-4 mb-2">
                                                    <input 
                                                        type="range" min="1" max="10" step="1"
                                                        value={bestN} onChange={(e) => setBestN(parseInt(e.target.value))}
                                                        className="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-purple-600"
                                                    />
                                                    <div className="w-12 h-12 rounded-lg bg-purple-50 border border-purple-200 flex items-center justify-center flex-col shrink-0">
                                                         <span className="text-lg font-bold text-purple-700 leading-none">{bestN}</span>
                                                         <span className="text-[8px] text-purple-400 uppercase font-bold">TOP</span>
                                                    </div>
                                             </div>
                                             <div className="flex justify-between items-center mt-2">
                                                    <div className="text-xs text-slate-400">
                                                         Sumuje tylko <span className="font-bold text-purple-600">{bestN}</span> najlepszych występów.
                                                    </div>
                                                    <button 
                                                         onClick={() => setShowBestNColumn(!showBestNColumn)} 
                                                         className={`flex items-center gap-1 px-2 py-1 text-[10px] font-bold rounded border transition-all ${showBestNColumn ? 'bg-purple-100 text-purple-700 border-purple-200' : 'bg-white text-slate-400 border-slate-200'}`}
                                                    >
                                                         {showBestNColumn ? <Eye size={12}/> : <EyeOff size={12}/>} {showBestNColumn ? 'Ukryj' : 'Pokaż'} kolumnę
                                                    </button>
                                             </div>
                                        </div>
                                   </div>
                                </div>
                            ) : (
                                <div className="bg-white rounded-xl border border-slate-200 shadow-sm p-6 h-full flex flex-col justify-center items-center text-center relative overflow-hidden">
                                   <div className={`absolute top-0 left-0 w-full h-1 bg-gradient-to-r ${activeTab === 'lgp2025' ? 'from-yellow-400 to-orange-500' : 'from-blue-400 to-indigo-500'}`}></div>
                                   {activeTab === 'lgp2025' ? <Sun size={48} className="text-orange-200 mb-4"/> : <Globe size={48} className="text-blue-200 mb-4" />}
                                   <h3 className="text-lg font-bold text-slate-800">
                                     {activeTab === 'lgp2025' ? 'Letnie Grand Prix 2025' : 'Puchar Świata 2024/25'}
                                   </h3>
                                   <p className="text-sm text-slate-500 max-w-lg mb-4">
                                     Tabela przedstawia klasyfikację generalną. Zawodnicy oznaczeni na <span className="text-red-600 font-black">czerwono</span> nie oddali żadnego skoku w ten weekend w Lillehammer (są nieaktywni).
                                     Użyj filtra "Tylko Draft", aby sprawdzić, którzy z Twoich zawodników punktują.
                                   </p>
                                   <div className="flex gap-4 text-xs font-bold">
                                        <span className="flex items-center gap-1 bg-indigo-100 text-indigo-700 px-2 py-1 rounded"><Star size={12}/> Twój Draft</span>
                                        <span className="flex items-center gap-1 bg-red-100 text-red-800 px-2 py-1 rounded border border-red-200"><XCircle size={12}/> Nieaktywny</span>
                                   </div>
                                </div>
                            )}
                        </div>
                    </div>

                    <div className="max-w-[1600px] mx-auto -mx-2 md:mx-auto overflow-hidden rounded-none md:rounded-2xl border-t border-b md:border border-slate-200 shadow-lg bg-white">
                        <div className="overflow-x-auto no-scrollbar">
                            <table className={`w-full ${activeTab === 'lillehammer' ? 'min-w-[1600px]' : 'min-w-full'} table-fixed`}>
                                <thead>
                                    <tr className="bg-slate-50 border-b border-slate-200 text-left">
                                        <th className="p-3 text-xs font-bold text-slate-500 uppercase tracking-wider w-12 text-center">#</th>
                                        <th className="p-3 text-xs font-bold text-slate-500 uppercase tracking-wider w-56">Zawodnik</th>
                                        
                                        {activeTab === 'lillehammer' ? (
                                            <>
                                                <th onClick={() => handleSort('seriesCount')} className={`p-2 text-[10px] font-bold text-slate-500 uppercase tracking-wider w-16 text-center cursor-pointer hover:bg-slate-100 ${sortBy === 'seriesCount' ? 'bg-slate-100 text-blue-600' : ''}`} title="Liczba zaliczonych serii">Serii</th>
                                                
                                                {Object.entries(EVENTS).map(([key, evt]) => {
                                                        if (!selectedColumns.includes(key)) return null;
                                                        return (
                                                                <th key={key} onClick={() => handleSort(key)} className={`p-2 text-[10px] uppercase tracking-wider text-center cursor-pointer transition-colors border-l border-slate-100 select-none group w-16 ${sortBy === key ? 'bg-blue-50 border-blue-200' : 'hover:bg-slate-100'}`} title={evt.full}>
                                                                    <div className={`flex flex-col items-center gap-1 ${evt.color}`}>
                                                                        <span>{evt.label.split(' ')[0]}</span>
                                                                        {sortBy === key && <div className="text-blue-600">{sortDirection === 'desc' ? <ChevronDown size={12}/> : <ChevronUp size={12}/>}</div>}
                                                                    </div>
                                                                </th>
                                                        )
                                                })}

                                                {showDraftColumn && (
                                                    <th onClick={() => handleSort('draftTotal')} className={`p-2 text-[10px] uppercase tracking-wider text-center cursor-pointer border-l-2 border-slate-300 w-24 bg-indigo-50 hover:bg-indigo-100 ${sortBy === 'draftTotal' ? 'bg-indigo-100 text-indigo-800' : 'text-slate-600'}`}>
                                                        <div className="flex flex-col items-center gap-1 font-bold">
                                                             <span className="text-indigo-700">Pkt Draft</span>
                                                             <span className="text-[8px] text-indigo-400">{draftMode === 'weekend' ? 'Sob+Ndz' : 'Ndz'}</span>
                                                             {sortBy === 'draftTotal' && (sortDirection === 'desc' ? <ChevronDown size={12}/> : <ChevronUp size={12}/>)}
                                                        </div>
                                                    </th>
                                                )}

                                                <th onClick={() => handleSort('customSum')} className={`p-2 text-[10px] uppercase tracking-wider text-center cursor-pointer border-l border-slate-200 w-24 bg-blue-50 hover:bg-blue-100 ${sortBy === 'customSum' ? 'bg-blue-100 text-blue-800' : 'text-slate-600'}`}>
                                                    <div className="flex flex-col items-center gap-1 font-bold">
                                                         <span>Wybór Σ</span>
                                                         {sortBy === 'customSum' && (sortDirection === 'desc' ? <ChevronDown size={12}/> : <ChevronUp size={12}/>)}
                                                    </div>
                                                </th>

                                                {showBestNColumn && (
                                                    <th onClick={() => handleSort('bestNSum')} className={`p-2 text-[10px] uppercase tracking-wider text-center cursor-pointer border-l border-slate-200 w-24 bg-purple-50 hover:bg-purple-100 ${sortBy === 'bestNSum' ? 'bg-purple-100 text-purple-800' : 'text-slate-600'}`}>
                                                        <div className="flex flex-col items-center gap-1 font-bold">
                                                             <span>Top{bestN} Σ</span>
                                                             {sortBy === 'bestNSum' && (sortDirection === 'desc' ? <ChevronDown size={12}/> : <ChevronUp size={12}/>)}
                                                        </div>
                                                    </th>
                                                )}
                                                
                                                {selectedColumns.length === ALL_EVENT_KEYS.length && (
                                                    <th className={`p-3 text-xs font-bold uppercase tracking-wider text-right cursor-pointer border-l border-slate-200 w-28 ${sortBy === 'totalPoints' ? 'bg-slate-800 text-white' : 'bg-slate-100 text-slate-600 hover:bg-slate-200'}`} onClick={() => handleSort('totalPoints')}>
                                                        <div className="flex items-center justify-end gap-1">
                                                            TOTAL
                                                            {sortBy === 'totalPoints' && (sortDirection === 'desc' ? <ChevronDown size={14}/> : <ChevronUp size={14}/>)}
                                                        </div>
                                                    </th>
                                                )}
                                            </>
                                        ) : (
                                            <>
                                                <th className="p-3 text-xs font-bold text-slate-500 uppercase tracking-wider text-center w-32">Status</th>
                                                <th className={`p-3 text-xs font-bold uppercase tracking-wider text-right cursor-pointer border-l border-slate-200 w-32 ${sortBy === 'points' ? 'bg-slate-100 text-blue-600' : 'text-slate-600 hover:bg-slate-50'}`} onClick={() => { setSortBy('points'); setSortDirection('desc'); }}>
                                                    Punkty {activeTab === 'lgp2025' ? 'LGP' : 'PŚ'}
                                                </th>
                                            </>
                                        )}
                                    </tr>
                                </thead>
                                <tbody className="divide-y divide-slate-100">
                                    {displayData.map((skier, index) => (
                                        <tr key={skier.name} className={getRowStyle(skier)}>
                                            <td className="p-2 text-center">
                                                <div className={`w-6 h-6 mx-auto flex items-center justify-center rounded-full text-xs font-bold border ${getRankBadgeStyle(skier.displayRank)}`}>
                                                    {skier.displayRank}
                                                </div>
                                            </td>
                                            <td className="p-2 truncate">
                                                <div className="flex items-center gap-3">
                                                    <img src={`https://flagcdn.com/w40/${skier.isoCode}.png`} alt={skier.country} className="w-6 h-4 object-cover rounded-sm shadow-sm" loading="lazy" />
                                                    <div className="overflow-hidden">
                                                        <div className="flex items-center gap-1">
                                                            <div className={`text-sm truncate ${!skier.isActive && activeTab !== 'lillehammer' ? 'font-extrabold text-red-900' : 'font-bold text-slate-800'}`} title={skier.name}>{skier.name}</div>
                                                            {skier.isDraft && <Star size={12} className="text-indigo-600 fill-indigo-600 shrink-0" />}
                                                        </div>
                                                        <div className="text-[10px] text-slate-400 font-mono flex gap-1">{skier.country}</div>
                                                    </div>
                                                </div>
                                            </td>

                                            {activeTab === 'lillehammer' ? (
                                                <>
                                                    <td className="p-2 text-center text-xs text-slate-500 font-mono">{skier.seriesCount}</td>
                                                    {Object.keys(EVENTS).map((evtKey) => {
                                                        if (!selectedColumns.includes(evtKey)) return null;
                                                        return (
                                                            <td key={evtKey} className={`p-1 text-center border-l border-slate-50 ${sortBy === evtKey ? 'bg-blue-50/30 font-bold text-blue-900' : ''}`}>
                                                                {skier[evtKey] > 0 ? (
                                                                    <span className={`text-xs ${sortBy === evtKey ? 'font-bold' : 'font-medium text-slate-600'}`}>{skier[evtKey].toFixed(1)}</span>
                                                                ) : (<span className="text-[10px] text-slate-200">-</span>)}
                                                            </td>
                                                        );
                                                    })}
                                                    {showDraftColumn && (
                                                        <td className={`p-2 text-center border-l-2 border-slate-200 font-mono text-xs bg-indigo-50 text-indigo-800 font-bold`}>{skier.draftTotal}</td>
                                                    )}
                                                    <td className={`p-2 text-center border-l-2 border-slate-200 font-mono text-xs ${sortBy === 'customSum' ? 'bg-blue-100 font-bold text-blue-900' : 'bg-blue-50/30 text-blue-700'}`}>{skier.customSum.toFixed(1)}</td>
                                                    
                                                    {showBestNColumn && (
                                                        <td className={`p-2 text-center border-l border-slate-200 font-mono text-xs ${sortBy === 'bestNSum' ? 'bg-purple-100 font-bold text-purple-900' : 'bg-purple-50/30 text-purple-700'}`}>{skier.bestNSum.toFixed(1)}</td>
                                                    )}
                                                    
                                                    {selectedColumns.length === ALL_EVENT_KEYS.length && (
                                                        <td className={`p-2 text-right border-l border-slate-100 ${sortBy === 'totalPoints' ? 'bg-slate-800 text-white' : ''}`}>
                                                            <div className={`font-extrabold text-sm ${sortBy === 'totalPoints' ? 'text-white' : 'text-slate-800'}`}>{skier.totalPoints.toFixed(1)}</div>
                                                            {skier.avgPoints > 0 && <div className={`text-[10px] ${sortBy === 'totalPoints' ? 'text-slate-400' : 'text-slate-400'}`}>Ø {skier.avgPoints}</div>}
                                                        </td>
                                                    )}
                                                </>
                                            ) : (
                                                <>
                                                    <td className="p-2 text-center">
                                                        {skier.isActive ? (
                                                            <span className="inline-flex items-center gap-1 px-2 py-1 rounded-full bg-green-100 text-green-700 text-[10px] font-bold uppercase tracking-wide">Aktywny</span>
                                                        ) : (
                                                            <span className="inline-flex items-center gap-1 px-2 py-1 rounded-full bg-red-200 text-red-900 border border-red-300 text-[10px] font-black uppercase tracking-wide shadow-sm"><XCircle size={12} strokeWidth={3} /> Nieaktywny</span>
                                                        )}
                                                    </td>
                                                    <td className="p-2 text-right border-l border-slate-100">
                                                        <div className="font-extrabold text-lg text-slate-800">{skier.points}</div>
                                                    </td>
                                                </>
                                            )}
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                            {displayData.length === 0 && <div className="p-12 text-center text-slate-400">Nie znaleziono zawodników spełniających kryteria.</div>}
                        </div>
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<SkiJumpingApp />);
    </script>
</body>
</html>